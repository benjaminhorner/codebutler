

    /**
     * Merge sort (http://en.wikipedia.org/wiki/Merge_sort)
     */
    /**
     * Description
     * @method mergeSort
     * @param {} arr
     * @param {} compareFn
     * @return CallExpression
     */
    function mergeSort(arr, compareFn) {
        if (arr == null) {
            return [];
        } else if (arr.length < 2) {
            return arr;
        }

        if (compareFn == null) {
            compareFn = defaultCompare;
        }

        var mid, left, right;

        mid   = ~~(arr.length / 2);
        left  = mergeSort( arr.slice(0, mid), compareFn );
        right = mergeSort( arr.slice(mid, arr.length), compareFn );

        return merge(left, right, compareFn);
    }

    /**
     * Description
     * @method defaultCompare
     * @param {} a
     * @param {} b
     * @return ConditionalExpression
     */
    function defaultCompare(a, b) {
        return a < b ? -1 : (a > b? 1 : 0);
    }

    /**
     * Description
     * @method merge
     * @param {} left
     * @param {} right
     * @param {} compareFn
     * @return result
     */
    function merge(left, right, compareFn) {
        var result = [];

        while (left.length && right.length) {
            if (compareFn(left[0], right[0]) <= 0) {
                // if 0 it should preserve same order (stable)
                result.push(left.shift());
            } else {
                result.push(right.shift());
            }
        }

        if (left.length) {
            result.push.apply(result, left);
        }

        if (right.length) {
            result.push.apply(result, right);
        }

        return result;
    }

    module.exports = mergeSort;


